# 实现MCP统计数据固化功能

## 任务描述
将MCP方法调用统计数据固化到文件中，在服务初始化时加载，并实现适当的保存机制，确保数据不会因服务崩溃而丢失。

## 实现方案分析

### 保存方式比较
1. **关闭服务时保存**：
   - 优点：实现简单，只需要在服务关闭时调用一次保存方法
   - 缺点：如果服务意外崩溃，所有未保存的数据都会丢失

2. **定时保存**：
   - 优点：数据安全性更高，即使服务崩溃，也只会丢失最近一次保存后的数据
   - 缺点：需要额外的定时任务，增加系统复杂性

### 建议方案
采用**定时保存+服务关闭时保存**的综合方案，这样可以兼顾数据安全性和系统可靠性。

## 实现步骤

1. **修改mcp_call_stats.py文件**：
   - 添加文件路径配置，默认保存到`logs/mcp_call_stats.json`
   - 添加`load_stats()`方法，在类初始化时加载数据
   - 添加`save_stats()`方法，用于保存数据到文件
   - 添加`_setup_auto_save()`方法，设置定时保存机制
   - 添加`_stop_auto_save()`方法，用于停止定时保存
   - 在类初始化时加载数据并启动定时保存

2. **修改MCPCallStats类**：
   - 将类变量改为实例变量，支持多个实例（如果需要）
   - 添加文件路径属性
   - 添加定时保存相关属性
   - 在关键方法中添加保存逻辑

3. **修改服务启动和关闭逻辑**：
   - 确保在服务关闭时调用保存方法

## 预期效果
- 服务启动时，自动从文件加载历史统计数据
- 定时（默认每小时）将统计数据保存到文件
- 服务关闭时，确保所有数据被保存
- 即使服务意外崩溃，也只会丢失最近一次保存后的数据
- 统计数据文件采用JSON格式，便于查看和分析

## 技术要点
- 使用threading.Timer实现定时保存
- 使用文件锁确保数据写入安全性
- 实现优雅的服务关闭处理
- 确保数据格式的兼容性和可扩展性