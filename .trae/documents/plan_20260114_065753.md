# 配置显示问题修复方案

## 问题分析

经过分析，ENABLE_QUERY_CACHE和ENABLE_METADATA_CACHE等配置在界面上显示为空，原因如下：

### 1. 缓存配置问题
- **PerformanceConfig**类包含`enable_query_cache`和`enable_metadata_cache`字段
- **to_dict()**方法中缺少`enable_metadata_cache`字段
- 导致该配置无法传递到HTML界面

### 2. 安全配置问题
- **SecurityConfig**类包含大量安全配置字段（50+个）
- **to_dict()**方法中只返回了10个字段
- 缺少关键的独立认证开关：`enable_token_auth`, `enable_jwt_auth`, `enable_oauth_auth`, `enable_basic_auth`
- 导致这些配置在界面上显示为空

## 修复方案

**文件**: `doris_mcp_server/utils/config.py`

**修改位置**: `to_dict()`方法

### 修复1：补充性能配置字段
在performance字典中添加`enable_metadata_cache`字段：

```python
"performance": {
    "enable_query_cache": self.performance.enable_query_cache,
    "enable_metadata_cache": self.performance.enable_metadata_cache,  # 添加这行
    "cache_ttl": self.performance.cache_ttl,
    # 其他字段...
},
```

### 修复2：补充安全配置字段
在security字典中添加缺少的关键字段：

```python
"security": {
    "auth_type": self.security.auth_type,
    "enable_token_auth": self.security.enable_token_auth,  # 添加
    "enable_jwt_auth": self.security.enable_jwt_auth,  # 添加
    "enable_oauth_auth": self.security.enable_oauth_auth,  # 添加
    "enable_basic_auth": self.security.enable_basic_auth,  # 添加
    "token_secret": "***",
    "token_expiry": self.security.token_expiry,
    "enable_security_check": self.security.enable_security_check,
    "blocked_keywords": self.security.blocked_keywords,
    "max_query_complexity": self.security.max_query_complexity,
    "max_result_rows": self.security.max_result_rows,
    "sensitive_tables": self.security.sensitive_tables,
    "enable_masking": self.security.enable_masking,
    "masking_rules": len(self.security.masking_rules),
},
```

## 预期效果

修复后，所有在HTML模板中定义的配置项都能在界面上正确显示其当前值，包括：

- ✅ ENABLE_QUERY_CACHE
- ✅ ENABLE_METADATA_CACHE
- ✅ 独立认证开关（Token/JWT/OAuth/Basic）
- ✅ 其他安全配置

用户可以通过配置管理界面完整查看所有配置的当前状态。

## 修复代码

完整的security和performance配置修复代码：

```python
"security": {
    "auth_type": self.security.auth_type,
    "enable_token_auth": self.security.enable_token_auth,
    "enable_jwt_auth": self.security.enable_jwt_auth,
    "enable_oauth_auth": self.security.enable_oauth_auth,
    "enable_basic_auth": self.security.enable_basic_auth,
    "token_secret": "***",
    "token_expiry": self.security.token_expiry,
    "enable_security_check": self.security.enable_security_check,
    "blocked_keywords": self.security.blocked_keywords,
    "max_query_complexity": self.security.max_query_complexity,
    "max_result_rows": self.security.max_result_rows,
    "sensitive_tables": self.security.sensitive_tables,
    "enable_masking": self.security.enable_masking,
    "masking_rules": len(self.security.masking_rules),
},
"performance": {
    "enable_query_cache": self.performance.enable_query_cache,
    "enable_metadata_cache": self.performance.enable_metadata_cache,
    "cache_ttl": self.performance.cache_ttl,
    "max_cache_size": self.performance.max_cache_size,
    "max_concurrent_queries": self.performance.max_concurrent_queries,
    "query_timeout": self.performance.query_timeout,
    "connection_pool_size": self.performance.connection_pool_size,
    "idle_timeout": self.performance.idle_timeout,
    "max_response_content_size": self.performance.max_response_content_size,
},
```

这个修复将确保所有在HTML模板中定义的配置项都能在界面上正确显示，解决配置显示为空的问题。