# 能耗BI Chat 需求文档

## 项目简介

基于Apache Doris MCP Server架构，开发一个专门针对能耗数据分析的智能对话系统。该系统将利用现有的能耗数据仓库（dw_power数据库），通过添加新的MCP工具，为用户提供能耗数据查询和分析服务。

## 项目约束

### 1. 技术约束
- **基础架构**: 基于现有的Apache Doris MCP Server进行二次开发
- **实现方式**: 通过在`DorisToolsManager`中添加新的MCP工具来扩展功能
- **数据库**: 使用现有的dw_power数据库，包含完整的能耗数据模型
- **开发语言**: Python 3.12+，保持与原项目一致
- **通信协议**: 支持MCP协议，保持HTTP和stdio两种模式
- **最小化改动**: 尽量减少对原有代码的修改，确保可以拉取上游最新代码

### 2. 业务约束
- **中文优先**: 所有用户交互界面和响应均使用中文
- **能耗专业**: 专注于能耗管理领域的业务场景
- **渐进式开发**: 先实现一个核心功能，再逐步扩展

### 3. 数据约束
- **数据源**: 基于doc/dw_power.sql中定义的表结构
- **数据安全**: 遵循原有的安全框架和权限控制
- **数据完整性**: 确保查询结果的准确性和一致性

## 需求列表

### 需求1: 能耗数据快速查询工具

**用户故事**: 作为能耗管理员，我希望能够通过一个MCP工具快速查询当前的能耗数据，以便了解实时的能耗状况。

#### 验收标准

1. WHEN 用户问"今天总用电量是多少" THEN 系统应自动选择合适的能耗工具并返回当日总电力消耗数据
2. WHEN 用户问"各个工序的用电情况" THEN 系统应返回按工序分组的电力消耗统计
3. WHEN 用户问"本月比上月用电量增加了多少" THEN 系统应返回月度用电量对比分析
4. WHEN 用户问"哪个车间耗电最多" THEN 系统应返回按车间排序的用电量排名
5. IF 查询涉及的时间范围或工序不存在 THEN 系统应返回友好的中文提示信息
6. WHEN 查询成功 THEN 系统应返回结构化的中文报告，包含数值、单位、时间范围等完整信息